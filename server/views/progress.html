<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" >
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Report...</title>

    <link rel="stylesheet" href="/assets/components/foundation/css/normalize.css">
    <link rel="stylesheet" href="/assets/components/foundation/css/foundation.css">
    <link rel="stylesheet" href="/assets/css/core.css">

    <script src="/assets/components/foundation/js/vendor/custom.modernizr.js"></script>
</head>
<body>

<section role="main">

    <div class="large-12 columns">

        <h3>Processing Repository&hellip;</h3>

        <ul id="ProgressLog"></ul>

        <div id="PlatoError" data-alert class="alert-box warning round" style="display:none;">
            <strong>There has been an error.</strong> Please see the last message.<br>
            You can try again by reloading the page.
        </div>

    </div>

</section>


<script src="/assets/components/jquery/jquery.min.js"></script>
<script src="/assets/components/foundation/js/foundation.min.js"></script>
<script src="/assets/js/core.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
(function ($) {
    var channelId = location.pathname.split('/').slice(1, -1).join('/'),
        socket    = io.connect('http://localhost'),
        $log      = $('#ProgressLog'),
        messageHandlers = {};

    messageHandlers.log = function (message) {
        $log.append(['<li>', message.text, '</li>'].join(''));
        window.scrollTo(0, 1e11);
    };

    messageHandlers.ready = function (message) {
        window.location = window.location;
    };

    messageHandlers.error = function (message) {
        $('#PlatoError').show();
    };

    socket.on('progress', function (data) {
        for (var i = 0, c = data.length, message; i < c; i++) {
            message = data[i];
            if (messageHandlers[message.type]) {
                messageHandlers[message.type](message);
            }
        }
    });

    socket.emit('join', channelId);
})(window.jQuery);
</script>
</body>
</html>
